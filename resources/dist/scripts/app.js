'use strict';

/**
 * File navigation.js.
 *
 * Handles toggling the navigation menu for small screens and enables TAB key
 * navigation support for dropdown menus.
 */
(function () {
	var container, button, menu, links, i, len, focusableElements, firstFocusableElement, lastFocusableElement;

	container = document.getElementById('js-menu--primary');

	// Bail if there is no menu.
	if (!container) {
		return;
	}

	button = container.getElementsByTagName('button')[0];
	if ('undefined' === typeof button) {
		return;
	}

	menu = container.getElementsByTagName('ul')[0];

	// Hide menu toggle button if menu is empty and return early.
	if ('undefined' === typeof menu) {
		button.style.display = 'none';
		return;
	}

	menu.setAttribute('aria-expanded', 'false');
	if (!menu.classList.contains('js-nav-menu')) {
		menu.classList.add('js-nav-menu');
	}

	button.addEventListener('click', function () {
		toggleMenu();

		setFocus();
	});

	// Close menu using Esc key.
	document.addEventListener('keyup', function (event) {
		if (27 === event.keyCode) {
			if (button.classList.contains('is-toggled')) {
				toggleMenu(); // Close menu.
				button.focus();
			}
		}
	});

	// Get all the link elements within the menu.
	links = menu.getElementsByTagName('a');

	// Each time a menu link is focused or blurred, toggle focus.
	for (i = 0, len = links.length; i < len; i++) {
		links[i].addEventListener('focus', toggleFocus, true);
		links[i].addEventListener('blur', toggleFocus, true);
	}

	/**
  * Toggle menu classes and ARIA.
  */
	function toggleMenu() {
		container.classList.toggle('is-toggled');
		menu.classList.toggle('is-toggled');
		button.classList.toggle('is-toggled');

		var expanded = 'false' === button.getAttribute('aria-expanded') ? 'true' : 'false';
		button.setAttribute('aria-expanded', expanded);
	}

	/**
  * Set focus when nav is open.
  */
	function setFocus() {

		// Bail if menu is not open.
		if (!button.classList.contains('is-toggled')) {
			return;
		}

		// Set focusable elements inside main navigation.
		focusableElements = container.querySelectorAll(['a[href]', 'area[href]', 'input:not([disabled])', 'select:not([disabled])', 'textarea:not([disabled])', 'button:not([disabled])', 'iframe', 'object', 'embed', '[contenteditable]', '[tabindex]:not([tabindex^="-"])']);
		firstFocusableElement = focusableElements[0];
		lastFocusableElement = focusableElements[focusableElements.length - 1];

		// Redirect last Tab to first focusable element.
		lastFocusableElement.addEventListener('keydown', function (e) {
			if (9 === e.keyCode && !e.shiftKey) {
				e.preventDefault();
				button.focus(); // Set focus on first element - that's actually close menu button.
			}
		});

		// Redirect first Shift+Tab to toggle button element.
		firstFocusableElement.addEventListener('keydown', function (e) {
			if (9 === e.keyCode && e.shiftKey) {
				e.preventDefault();
				button.focus(); // Set focus on first element.
			}
		});

		// Redirect Shift+Tab from the toggle button to last focusable element.
		button.addEventListener('keydown', function (e) {
			if (9 === e.keyCode && e.shiftKey) {
				e.preventDefault();
				lastFocusableElement.focus(); // Set focus on last element.
			}
		});
	}

	/**
  * Sets or removes .focus class on an element.
  */
	function toggleFocus() {
		var self = this;

		// Move up through the ancestors of the current link until we hit .js-nav-menu.
		while (-1 === self.className.indexOf('js-nav-menu')) {

			// On li elements toggle the class .focus.
			if ('li' === self.tagName.toLowerCase()) {
				if (-1 !== self.className.indexOf('focus')) {
					self.className = self.className.replace(' focus', '');
				} else {
					self.className += ' focus';
				}
			}

			self = self.parentElement;
		}
	}

	/**
  * Toggles `focus` class to allow submenu access on tablets.
  */
	(function (container) {
		var touchStartFn,
		    i,
		    parentLink = container.querySelectorAll('.menu-item-has-children > a, .page_item_has_children > a');

		if ('ontouchstart' in window) {
			touchStartFn = function touchStartFn(e) {
				var menuItem = this.parentNode,
				    i;

				if (!menuItem.classList.contains('focus')) {
					e.preventDefault();
					for (i = 0; i < menuItem.parentNode.children.length; ++i) {
						if (menuItem === menuItem.parentNode.children[i]) {
							continue;
						}
						menuItem.parentNode.children[i].classList.remove('focus');
					}
					menuItem.classList.add('focus');
				} else {
					menuItem.classList.remove('focus');
				}
			};

			for (i = 0; i < parentLink.length; ++i) {
				parentLink[i].addEventListener('touchstart', touchStartFn, false);
			}
		}
	})(container);
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJjb250YWluZXIiLCJidXR0b24iLCJtZW51IiwibGlua3MiLCJpIiwibGVuIiwiZm9jdXNhYmxlRWxlbWVudHMiLCJmaXJzdEZvY3VzYWJsZUVsZW1lbnQiLCJsYXN0Rm9jdXNhYmxlRWxlbWVudCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInN0eWxlIiwiZGlzcGxheSIsInNldEF0dHJpYnV0ZSIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwiYWRkIiwiYWRkRXZlbnRMaXN0ZW5lciIsInRvZ2dsZU1lbnUiLCJzZXRGb2N1cyIsImV2ZW50Iiwia2V5Q29kZSIsImZvY3VzIiwibGVuZ3RoIiwidG9nZ2xlRm9jdXMiLCJ0b2dnbGUiLCJleHBhbmRlZCIsImdldEF0dHJpYnV0ZSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJlIiwic2hpZnRLZXkiLCJwcmV2ZW50RGVmYXVsdCIsInNlbGYiLCJjbGFzc05hbWUiLCJpbmRleE9mIiwidGFnTmFtZSIsInRvTG93ZXJDYXNlIiwicmVwbGFjZSIsInBhcmVudEVsZW1lbnQiLCJ0b3VjaFN0YXJ0Rm4iLCJwYXJlbnRMaW5rIiwid2luZG93IiwibWVudUl0ZW0iLCJwYXJlbnROb2RlIiwiY2hpbGRyZW4iLCJyZW1vdmUiXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7OztBQU1FLGFBQVc7QUFDWixLQUFJQSxTQUFKLEVBQWVDLE1BQWYsRUFBdUJDLElBQXZCLEVBQTZCQyxLQUE3QixFQUFvQ0MsQ0FBcEMsRUFBdUNDLEdBQXZDLEVBQTRDQyxpQkFBNUMsRUFBK0RDLHFCQUEvRCxFQUFzRkMsb0JBQXRGOztBQUVBUixhQUFZUyxTQUFTQyxjQUFULENBQXlCLGtCQUF6QixDQUFaOztBQUVBO0FBQ0EsS0FBSyxDQUFFVixTQUFQLEVBQW1CO0FBQ2xCO0FBQ0E7O0FBRURDLFVBQVNELFVBQVVXLG9CQUFWLENBQWdDLFFBQWhDLEVBQTJDLENBQTNDLENB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QkFBZSxzQkFBVVYsQ0FBVixFQUFjO0FBQzVCLFFBQUlhLFdBQVcsS0FBS0MsVUFBcEI7QUFBQSxRQUNBeEMsQ0FEQTs7QUFHQSxRQUFLLENBQUV1QyxTQUFTNUIsU0FBVCxDQUFtQkMsUUFBbkIsQ0FBNkIsT0FBN0IsQ0FBUCxFQUFnRDtBQUMvQ2MsT0FBRUUsY0FBRjtBQUNBLFVBQU01QixJQUFJLENBQVYsRUFBYUEsSUFBSXVDLFNBQVNDLFVBQVQsQ0FBb0JDLFFBQXBCLENBQTZCckIsTUFBOUMsRUFBc0QsRUFBRXBCLENBQXhELEVBQTREO0FBQzNELFVBQUt1QyxhQUFhQSxTQUFTQyxVQUFULENBQW9CQyxRQUFwQixDQUE2QnpDLENBQTdCLENBQWxCLEVBQW9EO0FBQ25EO0FBQ0E7QUFDRHVDLGVBQVNDLFVBQVQsQ0FBb0JDLFFBQXBCLENBQTZCekMsQ0FBN0IsRUFBZ0NXLFNBQWhDLENBQTBDK0IsTUFBMUMsQ0FBa0QsT0FBbEQ7QUFDQTtBQUNESCxjQUFTNUIsU0FBVCxDQUFtQkUsR0FBbkIsQ0FBd0IsT0FBeEI7QUFDQSxLQVRELE1BU087QUFDTjBCLGNBQVM1QixTQUFULENBQW1CK0IsTUFBbkIsQ0FBMkIsT0FBM0I7QUFDQTtBQUNELElBaEJEOztBQWtCQSxRQUFNMUMsSUFBSSxDQUFWLEVBQWFBLElBQUlxQyxXQUFXakIsTUFBNUIsRUFBb0MsRUFBRXBCLENBQXRDLEVBQTBDO0FBQ3pDcUMsZUFBV3JDLENBQVgsRUFBY2MsZ0JBQWQsQ0FBZ0MsWUFBaEMsRUFBOENzQixZQUE5QyxFQUE0RCxLQUE1RDtBQUNBO0FBQ0Q7QUFDRCxFQTNCQyxFQTJCQ3hDLFNBM0JELENBQUY7QUE0QkEsQ0E5SkMsR0FBRiIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEZpbGUgbmF2aWdhdGlvbi5qcy5cbiAqXG4gKiBIYW5kbGVzIHRvZ2dsaW5nIHRoZSBuYXZpZ2F0aW9uIG1lbnUgZm9yIHNtYWxsIHNjcmVlbnMgYW5kIGVuYWJsZXMgVEFCIGtleVxuICogbmF2aWdhdGlvbiBzdXBwb3J0IGZvciBkcm9wZG93biBtZW51cy5cbiAqL1xuKCBmdW5jdGlvbigpIHtcblx0dmFyIGNvbnRhaW5lciwgYnV0dG9uLCBtZW51LCBsaW5rcywgaSwgbGVuLCBmb2N1c2FibGVFbGVtZW50cywgZmlyc3RGb2N1c2FibGVFbGVtZW50LCBsYXN0Rm9jdXNhYmxlRWxlbWVudDtcblxuXHRjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggJ2pzLW1lbnUtLXByaW1hcnknICk7XG5cblx0Ly8gQmFpbCBpZiB0aGVyZSBpcyBubyBtZW51LlxuXHRpZiAoICEgY29udGFpbmVyICkge1xuXHRcdHJldHVybjtcblx0fVxuXG5cdGJ1dHRvbiA9IGNvbnRhaW5lci5nZXRFbGVtZW50c0J5VGFnTmFtZSggJ2J1dHRvbicgKVswXTtcblx0aWYgKCAndW5kZWZpbmVkJyA9PT0gdHlwZW9mIGJ1dHRvbiApIHtcblx0XHRyZXR1cm47XG5cdH1cblxuXHRtZW51ID0gY29udGFpbmVyLmdldEVsZW1lbnRzQnlUYWdOYW1lKCAndWwnIClbMF07XG5cblx0Ly8gSGlkZSBtZW51IHRvZ2dsZSBidXR0b24gaWYgbWVudSBpcyBlbXB0eSBhbmQgcmV0dXJuIGVhcmx5LlxuXHRpZiAoICd1bmRlZmluZWQnID09PSB0eXBlb2YgbWVudSApIHtcblx0XHRidXR0b24uc3R5bGUuZGlzcGxheSA9ICdub25lJztcblx0XHRyZXR1cm47XG5cdH1cblxuXHRtZW51LnNldEF0dHJpYnV0ZSggJ2FyaWEtZXhwYW5kZWQnLCAnZmFsc2UnICk7XG5cdGlmICggISBtZW51LmNsYXNzTGlzdC5jb250YWlucyggJ2pzLW5hdi1tZW51JyApICkge1xuXHRcdG1lbnUuY2xhc3NMaXN0LmFkZCggJ2pzLW5hdi1tZW51JyApO1xuXHR9XG5cblx0YnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoICdjbGljaycsIGZ1bmN0aW9uKCkge1xuXHRcdHRvZ2dsZU1lbnUoKTtcblxuXHRcdHNldEZvY3VzKCk7XG5cdH0gKTtcblxuXHQvLyBDbG9zZSBtZW51IHVzaW5nIEVzYyBrZXkuXG5cdGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoICdrZXl1cCcsIGZ1bmN0aW9uKCBldmVudCApIHtcblx0XHRpZiAoIDI3ID09PSBldmVudC5rZXlDb2RlICkge1xuXHRcdFx0aWYgKCBidXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKCAnaXMtdG9nZ2xlZCcgKSApIHtcblx0XHRcdFx0dG9nZ2xlTWVudSgpOyAvLyBDbG9zZSBtZW51LlxuXHRcdFx0XHRidXR0b24uZm9jdXMoKTtcblx0XHRcdH1cblx0XHR9XG5cdH0gKTtcblxuXHQvLyBHZXQgYWxsIHRoZSBsaW5rIGVsZW1lbnRzIHdpdGhpbiB0aGUgbWVudS5cblx0bGlua3MgPSBtZW51LmdldEVsZW1lbnRzQnlUYWdOYW1lKCAnYScgKTtcblxuXHQvLyBFYWNoIHRpbWUgYSBtZW51IGxpbmsgaXMgZm9jdXNlZCBvciBibHVycmVkLCB0b2dnbGUgZm9jdXMuXG5cdGZvciAoIGkgPSAwLCBsZW4gPSBsaW5rcy5sZW5ndGg7IGkgPCBsZW47IGkrKyApIHtcblx0XHRsaW5rc1tpXS5hZGRFdmVudExpc3RlbmVyKCAnZm9jdXMnLCB0b2dnbGVGb2N1cywgdHJ1ZSApO1xuXHRcdGxpbmtzW2ldLmFkZEV2ZW50TGlzdGVuZXIoICdibHVyJywgdG9nZ2xlRm9jdXMsIHRydWUgKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBUb2dnbGUgbWVudSBjbGFzc2VzIGFuZCBBUklBLlxuXHQgKi9cblx0ZnVuY3Rpb24gdG9nZ2xlTWVudSgpIHtcblx0XHRjb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSggJ2lzLXRvZ2dsZWQnICk7XG5cdFx0bWVudS5jbGFzc0xpc3QudG9nZ2xlKCAnaXMtdG9nZ2xlZCcgKTtcblx0XHRidXR0b24uY2xhc3NMaXN0LnRvZ2dsZSggJ2lzLXRvZ2dsZWQnICk7XG5cblx0XHRsZXQgZXhwYW5kZWQgPSAoICdmYWxzZScgPT09IGJ1dHRvbi5nZXRBdHRyaWJ1dGUoICdhcmlhLWV4cGFuZGVkJyApICkgPyAndHJ1ZScgOiAnZmFsc2UnO1xuXHRcdGJ1dHRvbi5zZXRBdHRyaWJ1dGUoICdhcmlhLWV4cGFuZGVkJywgZXhwYW5kZWQgKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBTZXQgZm9jdXMgd2hlbiBuYXYgaXMgb3Blbi5cblx0ICovXG5cdGZ1bmN0aW9uIHNldEZvY3VzKCkge1xuXG5cdFx0Ly8gQmFpbCBpZiBtZW51IGlzIG5vdCBvcGVuLlxuXHRcdGlmICggISBidXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKCAnaXMtdG9nZ2xlZCcgKSApIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHQvLyBTZXQgZm9jdXNhYmxlIGVsZW1lbnRzIGluc2lkZSBtYWluIG5hdmlnYXRpb24uXG5cdFx0Zm9jdXNhYmxlRWxlbWVudHMgICAgID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoIFsgJ2FbaHJlZl0nLCAnYXJlYVtocmVmXScsICdpbnB1dDpub3QoW2Rpc2FibGVkXSknLCAnc2VsZWN0Om5vdChbZGlzYWJsZWRdKScsICd0ZXh0YXJlYTpub3QoW2Rpc2FibGVkXSknLCAnYnV0dG9uOm5vdChbZGlzYWJsZWRdKScsICdpZnJhbWUnLCAnb2JqZWN0JywgJ2VtYmVkJywgJ1tjb250ZW50ZWRpdGFibGVdJywgJ1t0YWJpbmRleF06bm90KFt0YWJpbmRleF49XCItXCJdKScgXSApO1xuXHRcdGZpcnN0Rm9jdXNhYmxlRWxlbWVudCA9IGZvY3VzYWJsZUVsZW1lbnRzWzBdO1xuXHRcdGxhc3RGb2N1c2FibGVFbGVtZW50ICA9IGZvY3VzYWJsZUVsZW1lbnRzW2ZvY3VzYWJsZUVsZW1lbnRzLmxlbmd0aCAtIDFdO1xuXG5cdFx0Ly8gUmVkaXJlY3QgbGFzdCBUYWIgdG8gZmlyc3QgZm9jdXNhYmxlIGVsZW1lbnQuXG5cdFx0bGFzdEZvY3VzYWJsZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggJ2tleWRvd24nLCBmdW5jdGlvbiggZSApIHtcblx0XHRcdGlmICggKCA5ID09PSBlLmtleUNvZGUgJiYgISBlLnNoaWZ0S2V5ICkgKSB7XG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0YnV0dG9uLmZvY3VzKCk7IC8vIFNldCBmb2N1cyBvbiBmaXJzdCBlbGVtZW50IC0gdGhhdCdzIGFjdHVhbGx5IGNsb3NlIG1lbnUgYnV0dG9uLlxuXHRcdFx0fVxuXHRcdH0gKTtcblxuXHRcdC8vIFJlZGlyZWN0IGZpcnN0IFNoaWZ0K1RhYiB0byB0b2dnbGUgYnV0dG9uIGVsZW1lbnQuXG5cdFx0Zmlyc3RGb2N1c2FibGVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoICdrZXlkb3duJywgZnVuY3Rpb24oIGUgKSB7XG5cdFx0XHRpZiAoICggOSA9PT0gZS5rZXlDb2RlICYmIGUuc2hpZnRLZXkgKSApIHtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRidXR0b24uZm9jdXMoKTsgLy8gU2V0IGZvY3VzIG9uIGZpcnN0IGVsZW1lbnQuXG5cdFx0XHR9XG5cdFx0fSApO1xuXG5cdFx0Ly8gUmVkaXJlY3QgU2hpZnQrVGFiIGZyb20gdGhlIHRvZ2dsZSBidXR0b24gdG8gbGFzdCBmb2N1c2FibGUgZWxlbWVudC5cblx0XHRidXR0b24uYWRkRXZlbnRMaXN0ZW5lciggJ2tleWRvd24nLCBmdW5jdGlvbiggZSApIHtcblx0XHRcdGlmICggKCA5ID09PSBlLmtleUNvZGUgJiYgZS5zaGlmdEtleSApICkge1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdGxhc3RGb2N1c2FibGVFbGVtZW50LmZvY3VzKCk7IC8vIFNldCBmb2N1cyBvbiBsYXN0IGVsZW1lbnQuXG5cdFx0XHR9XG5cdFx0fSApO1xuXHR9XG5cblx0LyoqXG5cdCAqIFNldHMgb3IgcmVtb3ZlcyAuZm9jdXMgY2xhc3Mgb24gYW4gZWxlbWVudC5cblx0ICovXG5cdGZ1bmN0aW9uIHRvZ2dsZUZvY3VzKCkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdC8vIE1vdmUgdXAgdGhyb3VnaCB0aGUgYW5jZXN0b3JzIG9mIHRoZSBjdXJyZW50IGxpbmsgdW50aWwgd2UgaGl0IC5qcy1uYXYtbWVudS5cblx0XHR3aGlsZSAoIC0xID09PSBzZWxmLmNsYXNzTmFtZS5pbmRleE9mKCAnanMtbmF2LW1lbnUnICkgKSB7XG5cblx0XHRcdC8vIE9uIGxpIGVsZW1lbnRzIHRvZ2dsZSB0aGUgY2xhc3MgLmZvY3VzLlxuXHRcdFx0aWYgKCAnbGknID09PSBzZWxmLnRhZ05hbWUudG9Mb3dlckNhc2UoKSApIHtcblx0XHRcdFx0aWYgKCAtMSAhPT0gc2VsZi5jbGFzc05hbWUuaW5kZXhPZiggJ2ZvY3VzJyApICkge1xuXHRcdFx0XHRcdHNlbGYuY2xhc3NOYW1lID0gc2VsZi5jbGFzc05hbWUucmVwbGFjZSggJyBmb2N1cycsICcnICk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0c2VsZi5jbGFzc05hbWUgKz0gJyBmb2N1cyc7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0c2VsZiA9IHNlbGYucGFyZW50RWxlbWVudDtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogVG9nZ2xlcyBgZm9jdXNgIGNsYXNzIHRvIGFsbG93IHN1Ym1lbnUgYWNjZXNzIG9uIHRhYmxldHMuXG5cdCAqL1xuXHQoIGZ1bmN0aW9uKCBjb250YWluZXIgKSB7XG5cdFx0dmFyIHRvdWNoU3RhcnRGbiwgaSxcblx0XHRcdHBhcmVudExpbmsgPSBjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCggJy5tZW51LWl0ZW0taGFzLWNoaWxkcmVuID4gYSwgLnBhZ2VfaXRlbV9oYXNfY2hpbGRyZW4gPiBhJyApO1xuXG5cdFx0aWYgKCAnb250b3VjaHN0YXJ0JyBpbiB3aW5kb3cgKSB7XG5cdFx0XHR0b3VjaFN0YXJ0Rm4gPSBmdW5jdGlvbiggZSApIHtcblx0XHRcdFx0dmFyIG1lbnVJdGVtID0gdGhpcy5wYXJlbnROb2RlLFxuXHRcdFx0XHRpO1xuXG5cdFx0XHRcdGlmICggISBtZW51SXRlbS5jbGFzc0xpc3QuY29udGFpbnMoICdmb2N1cycgKSApIHtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0Zm9yICggaSA9IDA7IGkgPCBtZW51SXRlbS5wYXJlbnROb2RlLmNoaWxkcmVuLmxlbmd0aDsgKytpICkge1xuXHRcdFx0XHRcdFx0aWYgKCBtZW51SXRlbSA9PT0gbWVudUl0ZW0ucGFyZW50Tm9kZS5jaGlsZHJlbltpXSApIHtcblx0XHRcdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRtZW51SXRlbS5wYXJlbnROb2RlLmNoaWxkcmVuW2ldLmNsYXNzTGlzdC5yZW1vdmUoICdmb2N1cycgKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0bWVudUl0ZW0uY2xhc3NMaXN0LmFkZCggJ2ZvY3VzJyApO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG1lbnVJdGVtLmNsYXNzTGlzdC5yZW1vdmUoICdmb2N1cycgKTtcblx0XHRcdFx0fVxuXHRcdFx0fTtcblxuXHRcdFx0Zm9yICggaSA9IDA7IGkgPCBwYXJlbnRMaW5rLmxlbmd0aDsgKytpICkge1xuXHRcdFx0XHRwYXJlbnRMaW5rW2ldLmFkZEV2ZW50TGlzdGVuZXIoICd0b3VjaHN0YXJ0JywgdG91Y2hTdGFydEZuLCBmYWxzZSApO1xuXHRcdFx0fVxuXHRcdH1cblx0fSggY29udGFpbmVyICkgKTtcbn0gKCkgKTtcbiJdfQ==
